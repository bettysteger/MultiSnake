<?xml version="1.0" encoding="utf-8"?>
<s:WindowedApplication xmlns:fx="http://ns.adobe.com/mxml/2009" 
					   xmlns:s="library://ns.adobe.com/flex/spark" 
					   xmlns:mx="library://ns.adobe.com/flex/mx"
					   applicationComplete="creationcompl()"
					   showStatusBar="false">
	<fx:Style source="multisnake.css"/>

	<fx:Script>
		<![CDATA[
			import game.Game;
			import game.Snake;
			
			import mx.core.FlexGlobals;
			import mx.core.UIComponent;
			private var theGame:Game;
			private var _gameStopped:Boolean = true;
			public var window_width:int;
			public var window_height:int;
			
			private function fullscreen():void {
				FlexGlobals.topLevelApplication.stage.displayState = StageDisplayState.FULL_SCREEN_INTERACTIVE;
			}
			
			private function creationcompl():void {
				fullscreen();
				window_width=stage.width;
				window_height=stage.height;
				stage.addEventListener(KeyboardEvent.KEY_DOWN, function(e:KeyboardEvent):void {
					if(e.keyCode == 9 && _gameStopped) { // TABULATOR KEY
						callLater(startGame);
					}
					if(e.keyCode == 49) // 1 KEY
						fullscreen();					
				});
			}
			
			private function startGame():void {
				currentState="Game";
				theGame = new Game;
				_gameStopped = false;
				gameContainer.addChild(theGame);
			}
			
			public function endGame():void {
				_gameStopped=true;
				currentState="Scores";
				try {
					gameContainer.removeChild(theGame);
				}catch(e:Error){}
				var players:Array = theGame.getPlayers();
				for(var i:int;i<players.length;i++) {
					trace("PLACE "+i+": "+Snake(players[i]).playerID+" with score: "+Snake(players[i]).score);
					var x:int;
					var y:int;
					
					switch(i) {
						case 0:
							x=323;
							y=167;
							first.text = Snake(players[i]).playerID+": "+Snake(players[i]).score;
							break;
						case 1:
							x=243;
							y=187;
							second.text = Snake(players[i]).playerID+": "+Snake(players[i]).score;
							break;
						case 2:
							x=401;
							y=208;
							third.text = Snake(players[i]).playerID+": "+Snake(players[i]).score;
							break;
						default:
							x=551;
							y=263;
							fourth.text = Snake(players[i]).playerID+": "+Snake(players[i]).score;
					}
					
					switch(Snake(players[i]).playerID){
						case "red":
							red_player.x=x;
							red_player.y=y;
							break;
						case "green":
							green_player.x=x;
							green_player.y=y;
							break;
						case "yellow":
							yellow_player.x=x;
							yellow_player.y=y;
							break;
						case "blue":
							blue_player.x=x;
							blue_player.y=y;
					}
				}
			}
		]]>
	</fx:Script>
	
	<s:states>
		<s:State name="Start"/>
		<s:State name="Game"/>
		<s:State name="Scores"/>
	</s:states>
	
	<s:VGroup includeIn="Start" height="100%" width="100%" verticalAlign="middle">
		<s:HGroup width="100%" horizontalAlign="center">
			<s:Button  label="Start Game" width="591" height="157" x="275" click="fullscreen();startGame();"/>
		</s:HGroup>
	</s:VGroup>
	
	<mx:UIComponent width="100%" height="100%" includeIn="Game" id="gameContainer" />
	
	<s:Group includeIn="Scores" horizontalCenter="-0" verticalCenter="0">
		<mx:Image includeIn="Scores" source="@Embed(source='../assets/stairs.png')" horizontalCenter="0" verticalCenter="44"/>
		<mx:Image id="blue_player" includeIn="Scores" x="401" y="208" source="@Embed(source='../assets/snake_blue.png')"/>
		<mx:Image id="green_player" includeIn="Scores" x="243" y="187" source="@Embed(source='../assets/snake_green.png')"/>
		<mx:Image id="red_player" includeIn="Scores" x="323" y="167" source="@Embed(source='../assets/snake_red.png')"/>
		<mx:Image id="yellow_player" includeIn="Scores" x="551" y="263" source="@Embed(source='../assets/snake_yellow.png')"/>
		<s:Label includeIn="Scores" text="Congratulations!" horizontalCenter="0" verticalCenter="-196" fontFamily="Arial"/>
		<s:VGroup right="0" bottom="0" fontFamily="Arial" fontSize="15">
			<s:Label id="first" includeIn="Scores" />
			<s:Label id="second" includeIn="Scores" />
			<s:Label id="third" includeIn="Scores" />
			<s:Label id="fourth" includeIn="Scores" />
		</s:VGroup>

	</s:Group>
	<s:Button includeIn="Scores" label="Restart Game" fontSize="15" horizontalCenter="0" bottom="20" click="startGame()"/>
</s:WindowedApplication>
